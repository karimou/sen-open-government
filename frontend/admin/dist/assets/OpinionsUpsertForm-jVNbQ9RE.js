import{c as q,d as $,a as A,u as E,s as I}from"./message.esm-DA8zJJ8T.js";import{s as L}from"./index.esm-7P6y4mBq.js";import{s as O}from"./textarea.esm-Zu41E-81.js";import{s as M}from"./editor.esm-UoywPXbm.js";import{c as _}from"./AppTableSkeleton-FqvfmN-I.js";import{r as b,Y as T,a as z,j as D,A as x,o,c as n,b as a,t as i,f as t,e as d,w as k,W as h,g as S,F as W,p as Y,h as G}from"./index-9WfbBEsR.js";import{u as H}from"./persons-olfuQxH3.js";import{u as J}from"./issues-zrbi5rwy.js";const K={style:{width:"650px"}},Q=["initial-values"],X={class:"formgrid grid"},Z={class:"field col-6"},P=a("label",{for:"title"},"Auteur",-1),ee={key:0},se={key:1},te={key:0},oe={key:1},ae={class:"field col-6"},le=a("label",{for:"title"},"Thème",-1),ie={class:"field"},ne=a("label",{for:"summary"},"Résumé",-1),re={class:"field"},ue=a("label",{for:"content"},"Contenu détaillé",-1),Se={__name:"OpinionsUpsertForm",setup(de){const C=q({author_id:$().required(),issue_id:$().required(),summary:A().required(),content:A()}),{handleSubmit:F,errors:R,defineField:c,setFieldValue:U}=E({validationSchema:C}),[v,ce]=c("author_id"),[y,me]=c("issue_id"),[V,pe]=c("summary"),[g,fe]=c("content"),m=b(null),r=H(),p=J(),B=b({}),u=T("dialogRef");z(()=>{var l;["author_id","issue_id","summary","content"].forEach(e=>{u.value.data[e]&&U(e,u.value.data[e])}),m.value=(l=u.value.data)==null?void 0:l.id,r.persons||r.refreshPersons(),p.issues||p.refreshIssues()});const N=D(()=>{let l={};return r.persons.forEach(e=>l[e.id]=`${e.firstname} ${e.lastname}`),l}),f=b(!1),w=F(l=>{f.value=!0,m.value?x.opinions.updateOpinion({...l,id:m.value}).then(e=>{u.value.close()}).finally(()=>f.value=!1):x.opinions.addOpinion(l).then(e=>{u.value.close()}).finally(()=>f.value=!1)});return(l,e)=>(o(),n("div",K,[a("h5",null,i(m.value?"Modifier":"Ajouter")+" une opinion",1),a("form",{onSubmit:e[4]||(e[4]=(...s)=>t(w)&&t(w)(...s)),"initial-values":B.value.value},[a("div",X,[a("div",Z,[P,t(r).persons?(o(),d(t(_),{key:1,modelValue:t(v),"onUpdate:modelValue":e[0]||(e[0]=s=>h(v)?v.value=s:null),options:t(r).persons,optionLabel:"firstname",optionValue:"id",placeholder:"Choisir une personne",class:"w-full"},{value:k(s=>[s.value?(o(),n("span",ee,i(N.value[s.value]),1)):(o(),n("span",se,i(s.placeholder),1))]),option:k(s=>[s.option?(o(),n("span",te,i(s.option.firstname)+" "+i(s.option.lastname),1)):(o(),n("span",oe,i(s.placeholder),1))]),_:1},8,["modelValue","options"])):(o(),d(t(_),{key:0,loading:"",placeholder:"Chargement en cours...",class:"w-full"}))]),a("div",ae,[le,t(p).issues?(o(),d(t(_),{key:1,modelValue:t(y),"onUpdate:modelValue":e[1]||(e[1]=s=>h(y)?y.value=s:null),options:t(p).issues,optionLabel:"title",optionValue:"id",placeholder:"Choisir un thème",class:"w-full"},null,8,["modelValue","options"])):(o(),d(t(_),{key:0,loading:"",placeholder:"Chargement en cours...",class:"w-full"}))])]),a("div",ie,[ne,S(t(O),{id:"summary",modelValue:t(V),"onUpdate:modelValue":e[2]||(e[2]=s=>h(V)?V.value=s:null),class:"w-full",autoResize:!0},null,8,["modelValue"])]),a("div",re,[ue,S(t(M),{modelValue:t(g),"onUpdate:modelValue":e[3]||(e[3]=s=>h(g)?g.value=s:null),id:"content",editorStyle:"height: 320px"},null,8,["modelValue"])]),S(t(L),{type:"submit",label:"Soumettre",class:"w-full",loading:f.value},null,8,["loading"])],40,Q),(o(!0),n(W,null,Y(t(R),(s,j)=>(o(),d(t(I),{severity:"error",key:j},{default:k(()=>[G(i(s),1)]),_:2},1024))),128))]))}};export{Se as default};
