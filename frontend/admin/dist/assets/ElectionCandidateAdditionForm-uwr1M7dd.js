import{r as V,X as N,a as R,$ as U,A as j,u as D,o as t,c as l,b as r,f as o,e as c,w as h,E as i,V as g,g as k,F as P,n as q,h as T,i as M,_ as O}from"./index-HWtTsvFM.js";import{c as X,d as b,u as z,s as G}from"./message.esm-OieoKZiQ.js";import{s as C}from"./index.esm-FaUUA4nG.js";import{c as f}from"./AppTableSkeleton-3-U8kaGt.js";import{u as H}from"./persons-MqOyPKi7.js";import{u as J}from"./ElectionsView-5goY7h5Q.js";const K={style:{width:"350px"}},Q=r("h5",null,"Ajouter un candidat",-1),W=["initial-values"],Y={class:"field"},Z=r("label",{for:"title"},"Candidat",-1),ee={key:0},oe={key:1},se={key:0},te={key:1},ae={class:"field"},ne=r("label",{for:"title"},"Élection",-1),_e={__name:"ElectionCandidateAdditionForm",setup(le){const S=X({electionId:b().required(),personId:b().required()}),{handleSubmit:A,errors:E,defineField:v,setFieldValue:I}=z({validationSchema:S}),[u,ie]=v("electionId"),[p,re]=v("personId"),a=H(),m=J(),w=V({}),d=N("dialogRef");R(()=>{d.value.data.electionId&&I("electionId",d.value.data.electionId),d.value.data.personId&&I("personId",d.value.data.personId),a.persons||a.refreshPersons(),m.elections||m.refreshElections()});const F=U(()=>{let n={};return a.persons.forEach(s=>n[s.id]=`${s.firstname} ${s.lastname}`),n}),_=V(!1),y=A(n=>{_.value=!0,j.elections.addElectionCandidate({electionId:u.value,personId:p.value}).then(s=>{d.value.close("success")}).finally(()=>_.value=!1)}),$=D(),x=M(()=>O(()=>import("./PersonsUpsertForm-axZhbO31.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),B=(n={})=>{$.open(x,{data:n,onClose:s=>{(s==null?void 0:s.data)=="success"&&a.refreshPersons()},props:{modal:!0}})};return(n,s)=>(t(),l("div",K,[Q,r("form",{onSubmit:s[2]||(s[2]=(...e)=>o(y)&&o(y)(...e)),"initial-values":w.value.value},[r("div",Y,[Z,o(a).persons?(t(),c(o(f),{key:1,modelValue:o(p),"onUpdate:modelValue":s[0]||(s[0]=e=>g(p)?p.value=e:null),options:o(a).persons,optionLabel:"firstname",optionValue:"id",placeholder:"Choisir une personne",class:"w-full",filter:""},{value:h(e=>[e.value?(t(),l("span",ee,i(F.value[e.value]),1)):(t(),l("span",oe,i(e.placeholder),1))]),option:h(e=>[e.option?(t(),l("span",se,i(e.option.firstname)+" "+i(e.option.lastname),1)):(t(),l("span",te,i(e.placeholder),1))]),_:1},8,["modelValue","options"])):(t(),c(o(f),{key:0,loading:"",placeholder:"Chargement en cours...",class:"w-full"})),k(o(C),{label:"Ajouter une personne",icon:"pi pi-plus",text:"",onClick:B})]),r("div",ae,[ne,o(m).elections?(t(),c(o(f),{key:1,modelValue:o(u),"onUpdate:modelValue":s[1]||(s[1]=e=>g(u)?u.value=e:null),options:o(m).elections,optionLabel:"title",optionValue:"id",placeholder:"Choisir une élection",class:"w-full",filter:""},null,8,["modelValue","options"])):(t(),c(o(f),{key:0,loading:"",placeholder:"Chargement en cours...",class:"w-full"}))]),k(o(C),{type:"submit",label:"Soumettre",class:"w-full",loading:_.value},null,8,["loading"])],40,W),(t(!0),l(P,null,q(o(E),(e,L)=>(t(),c(o(G),{severity:"error",key:L},{default:h(()=>[T(i(e),1)]),_:2},1024))),128))]))}};export{_e as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/PersonsUpsertForm-axZhbO31.js","assets/message.esm-OieoKZiQ.js","assets/index-HWtTsvFM.js","assets/index-tbN9M-MT.css","assets/index.esm-FaUUA4nG.js","assets/textarea.esm-WoudxIoE.js","assets/editor.esm-kVSwRZPD.js","assets/format-39s6QTMr.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
