import{$ as E,r as b,u as M,Y as T,a as n,c as p,b as o,f as e,e as h,g as l,H as k,w as d,F as $,j as _,E as G,h as D,A as L,i as q,_ as Y}from"./index-D7X0WbD9.js";import{c as z,s as J,a as m,b as K,_ as Q}from"./AppTableSkeleton-F_Hh2g5g.js";import{s as v}from"./index.esm-gdRg23pp.js";import{s as R}from"./avatar.esm-DkWrDWgk.js";const W={class:"grid"},X={class:"col-12"},Z={key:1,class:"card"},P={class:"my-2"},ee={class:"p-float-label"},te=o("label",null,"Grouper par:",-1),ae=o("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},[o("h5",{class:"m-0"},"Opinions")],-1),oe={class:"vertical-align-middle ml-2 font-bold line-height-3"},se={class:"vertical-align-middle ml-2 font-bold line-height-3"},le={key:2,class:"px-4 py-5 shadow-1 flex flex-column md:flex-row md:align-items-center justify-content-between mb-3",style:{width:"600px","background-color":"white"}},ne=o("div",null,[o("div",{class:"font-medium text-xl mt-2 mb-3"},"Aucune opinion"),o("div",{class:"font-medium"},"Cliquer sur le bouton suivant pour rajouter une première opinion à la base de données")],-1),ie={class:"mt-4 mr-auto md:mt-0 md:mr-0"},ce={__name:"BaseOpinionsTable",props:{opinions:Array,personId:Number,issueId:Number,defaultGroupingHeader:{type:String,default:"author.name"},group:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["refresh"],setup(A,{emit:C}){const O=A,{opinions:y,group:u,personId:B,issueId:S,loading:c,defaultGroupingHeader:V}=E(O),w=C,r=b(null),j=()=>{var a;let s=(a=r.value)==null?void 0:a.map(f=>f.id);c.value=!0,L.opinions.deleteOpinions(s).then(()=>{w("refresh"),r.value=null}).finally(()=>c.value=!1)},N=M(),F=q(()=>Y(()=>import("./OpinionsUpsertForm-r9knx1g_.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),g=(s={author_id:B.value,issue_id:S.value})=>{N.open(F,{data:s,onClose:()=>w("refresh"),props:{modal:!0}})},I=s=>`${s.firstname} ${s.lastname}`,H=T(()=>y.value.map(s=>({...s,author:{...s.author,name:I(s.author)}}))),x=b(),i=b(V.value),U=[{field:"author.name",label:"Auteur"},{field:"issue.title",label:"Thème"}];return(s,a)=>{var f;return n(),p("div",W,[o("div",X,[e(c)?(n(),h(Q,{key:0})):((f=e(y))==null?void 0:f.length)>0?(n(),p("div",Z,[l(e(J),{class:"mb-4"},k({start:d(()=>[o("div",P,[l(e(v),{label:"Ajouter une opinion",icon:"pi pi-plus",class:"p-button-success mr-2",onClick:a[0]||(a[0]=t=>g())}),l(e(v),{label:"Supprimer la sélection",icon:"pi pi-trash",class:"p-button-danger",onClick:a[1]||(a[1]=t=>j()),disabled:!r.value||!r.value.length,loading:e(c)},null,8,["disabled","loading"])])]),_:2},[e(u)?{name:"end",fn:d(()=>[o("div",ee,[l(e(z),{options:U,modelValue:i.value,"onUpdate:modelValue":a[2]||(a[2]=t=>i.value=t),optionLabel:"label",optionValue:"field"},null,8,["modelValue"]),te])]),key:"0"}:void 0]),1024),(n(),h(e(K),{key:i.value,value:H.value,tableStyle:"min-width: 50rem",selection:r.value,"onUpdate:selection":a[3]||(a[3]=t=>r.value=t),expandedRowGroups:x.value,"onUpdate:expandedRowGroups":a[4]||(a[4]=t=>x.value=t),expandableRowGroups:e(u),rowGroupMode:e(u)?"subheader":null,groupRowsBy:e(u)?i.value:null,sortMode:"single",sortField:i.value,sortOrder:1},k({header:d(()=>[ae]),default:d(()=>[l(e(m),{selectionMode:"multiple",headerStyle:"width: 3rem"}),l(e(m),{headerStyle:"width: 60px"},{body:d(({data:t})=>[l(e(v),{class:"p-button-text p-button-rounded",icon:"pi pi-pencil",onClick:de=>g(t)},null,8,["onClick"])]),_:1}),l(e(m),{field:"author.name",header:"Auteur"}),l(e(m),{field:"issue.title",header:"Sujet"}),l(e(m),{field:"summary",header:"Résumé"})]),_:2},[e(u)?{name:"groupheader",fn:d(t=>[i.value=="author.name"?(n(),p($,{key:0},[t.data.author.photo?(n(),h(e(R),{key:0,class:"contained-image ml-2 vertical-align-middle",image:t.data.author.photo,width:"32",shape:"circle"},null,8,["image"])):_("",!0),o("span",oe,G(t.data.author.name),1)],64)):i.value=="issue.title"?(n(),p($,{key:1},[t.data.issue.photo?(n(),h(e(R),{key:0,class:"contained-image ml-2 vertical-align-middle",image:t.data.issue.photo,width:"32",shape:"circle"},null,8,["image"])):_("",!0),o("span",se,G(t.data.issue.title),1)],64)):_("",!0)]),key:"0"}:void 0]),1032,["value","selection","expandedRowGroups","expandableRowGroups","rowGroupMode","groupRowsBy","sortField"]))])):(n(),p("div",le,[ne,o("div",ie,[l(e(v),{class:"p-button font-bold px-5 py-3 p-button-success p-button-rounded p-button-raised",onClick:a[5]||(a[5]=t=>g())},{default:d(()=>[D("Ajouter")]),_:1})])]))])])}}};export{ce as _};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/OpinionsUpsertForm-r9knx1g_.js","assets/index-D7X0WbD9.js","assets/index-D9x--RlZ.css","assets/message.esm-R2931qIK.js","assets/index.esm-gdRg23pp.js","assets/textarea.esm-DaVE8NbD.js","assets/editor.esm-li_xWJSK.js","assets/AppTableSkeleton-F_Hh2g5g.js","assets/persons-OCNWAU73.js","assets/issues-1Q2RHDve.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
