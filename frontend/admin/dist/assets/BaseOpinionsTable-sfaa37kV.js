import{$ as L,r as _,u as q,Y,a as n,c as p,b as s,f as e,e as h,g as a,H as A,w as i,F as I,j as y,E as w,h as z,A as J,i as R,_ as G}from"./index-mqQjfPOb.js";import{c as K,s as Q,a as m,b as W,_ as X}from"./AppTableSkeleton-i4JGvXbu.js";import{s as c}from"./index.esm-8WYIV_VM.js";import{s as S}from"./avatar.esm-t1uXVIqu.js";const Z={class:"grid"},P={class:"col-12"},ee={key:1,class:"card"},te={class:"my-2"},oe={class:"p-float-label"},se=s("label",null,"Grouper par:",-1),ae=s("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},[s("h5",{class:"m-0"},"Opinions")],-1),le={class:"vertical-align-middle ml-2 font-bold line-height-3"},ne={class:"vertical-align-middle ml-2 font-bold line-height-3"},ie={class:"truncate l3"},de={key:2,class:"px-4 py-5 shadow-1 flex flex-column md:flex-row md:align-items-center justify-content-between mb-3",style:{width:"600px","background-color":"white"}},re=s("div",null,[s("div",{class:"font-medium text-xl mt-2 mb-3"},"Aucune opinion"),s("div",{class:"font-medium"},"Cliquer sur le bouton suivant pour rajouter une première opinion à la base de données")],-1),ue={class:"mt-4 mr-auto md:mt-0 md:mr-0"},he={__name:"BaseOpinionsTable",props:{opinions:Array,personId:Number,issueId:Number,defaultGroupingHeader:{type:String,default:"author.name"},group:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["refresh"],setup(V,{emit:B}){const j=V,{opinions:x,group:u,personId:k,issueId:C,loading:f,defaultGroupingHeader:N}=L(j),b=B,r=_(null),E=()=>{var o;let l=(o=r.value)==null?void 0:o.map(v=>v.id);f.value=!0,J.opinions.deleteOpinions(l).then(()=>{b("refresh"),r.value=null}).finally(()=>f.value=!1)},$=q(),F=R(()=>G(()=>import("./OpinionsUpsertForm-FQlhJwQ6.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),g=(l={author_id:k.value,issue_id:C.value})=>{$.open(F,{data:l,onClose:()=>b("refresh"),props:{modal:!0}})},D=R(()=>G(()=>import("./AppOpinionsCsvImport-EdZKRWxJ.js"),__vite__mapDeps([11,1,2,8,5,12,4,10,9]))),H=()=>{$.open(D,{data:{personId:k.value,issueId:C.value},onClose:()=>b("refresh"),props:{modal:!0}})},T=l=>`${l.firstname} ${l.lastname}`,U=Y(()=>x.value.map(l=>({...l,author:{...l.author,name:T(l.author)}}))),O=_(),d=_(N.value),M=[{field:"author.name",label:"Auteur"},{field:"issue.title",label:"Thème"}];return(l,o)=>{var v;return n(),p("div",Z,[s("div",P,[e(f)?(n(),h(X,{key:0})):((v=e(x))==null?void 0:v.length)>0?(n(),p("div",ee,[a(e(Q),{class:"mb-4"},A({start:i(()=>[s("div",te,[a(e(c),{label:"Ajouter une opinion",icon:"pi pi-plus",class:"p-button-success mr-2",onClick:o[0]||(o[0]=t=>g())}),a(e(c),{label:"Import un CSV",icon:"pi pi-file-import",class:"p-button-primary mr-2",onClick:o[1]||(o[1]=t=>H())}),a(e(c),{label:"Supprimer la sélection",icon:"pi pi-trash",class:"p-button-danger",onClick:o[2]||(o[2]=t=>E()),disabled:!r.value||!r.value.length,loading:e(f)},null,8,["disabled","loading"])])]),_:2},[e(u)?{name:"end",fn:i(()=>[s("div",oe,[a(e(K),{options:M,modelValue:d.value,"onUpdate:modelValue":o[3]||(o[3]=t=>d.value=t),optionLabel:"label",optionValue:"field"},null,8,["modelValue"]),se])]),key:"0"}:void 0]),1024),(n(),h(e(W),{key:d.value,value:U.value,tableStyle:"min-width: 50rem",selection:r.value,"onUpdate:selection":o[4]||(o[4]=t=>r.value=t),expandedRowGroups:O.value,"onUpdate:expandedRowGroups":o[5]||(o[5]=t=>O.value=t),expandableRowGroups:e(u),rowGroupMode:e(u)?"subheader":null,groupRowsBy:e(u)?d.value:null,sortMode:"single",sortField:d.value,sortOrder:1},A({header:i(()=>[ae]),default:i(()=>[a(e(m),{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(e(m),{headerStyle:"width: 60px"},{body:i(({data:t})=>[a(e(c),{class:"p-button-text p-button-rounded",icon:"pi pi-pencil",onClick:pe=>g(t)},null,8,["onClick"])]),_:1}),a(e(m),{field:"author.name",header:"Auteur"}),a(e(m),{field:"issue.title",header:"Sujet"}),a(e(m),{field:"summary",header:"Résumé",headerStyle:"width: 500px"},{body:i(({data:t})=>[s("p",ie,w(t.summary),1)]),_:1})]),_:2},[e(u)?{name:"groupheader",fn:i(t=>[d.value=="author.name"?(n(),p(I,{key:0},[t.data.author.photo?(n(),h(e(S),{key:0,class:"contained-image ml-2 vertical-align-middle",image:t.data.author.photo,width:"32",shape:"circle"},null,8,["image"])):y("",!0),s("span",le,w(t.data.author.name),1)],64)):d.value=="issue.title"?(n(),p(I,{key:1},[t.data.issue.photo?(n(),h(e(S),{key:0,class:"contained-image ml-2 vertical-align-middle",image:t.data.issue.photo,width:"32",shape:"circle"},null,8,["image"])):y("",!0),s("span",ne,w(t.data.issue.title),1)],64)):y("",!0)]),key:"0"}:void 0]),1032,["value","selection","expandedRowGroups","expandableRowGroups","rowGroupMode","groupRowsBy","sortField"]))])):(n(),p("div",de,[re,s("div",ue,[a(e(c),{class:"p-button font-bold px-5 py-3 p-button-success p-button-rounded p-button-raised",onClick:o[6]||(o[6]=t=>g())},{default:i(()=>[z("Ajouter")]),_:1})])]))])])}}};export{he as _};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/OpinionsUpsertForm-FQlhJwQ6.js","assets/index-mqQjfPOb.js","assets/index-ZWerLMmy.css","assets/index.esm-YLBYxjLo.js","assets/message.esm-m1pzN4mq.js","assets/index.esm-8WYIV_VM.js","assets/textarea.esm-thJ20K8f.js","assets/editor.esm-Tpg0OTQB.js","assets/AppTableSkeleton-i4JGvXbu.js","assets/persons-vmc6YvXU.js","assets/issues-IHHpQ1lA.js","assets/AppOpinionsCsvImport-EdZKRWxJ.js","assets/fileupload.esm-IID_HbMp.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
