import{c as F,d as g,u as $,s as x}from"./message.esm-DA8zJJ8T.js";import{s as B}from"./index.esm-7P6y4mBq.js";import"./textarea.esm-Zu41E-81.js";import"./editor.esm-UoywPXbm.js";import{c as f}from"./AppTableSkeleton-FqvfmN-I.js";import{r as h,Y as N,a as j,j as L,A as R,o as s,c as l,b as n,f as o,e as d,w as v,t as a,W as k,g as q,F as U,p as D,h as M}from"./index-9WfbBEsR.js";import{u as T}from"./persons-olfuQxH3.js";import{u as W}from"./ElectionsView-aFFbvk0a.js";const Y={style:{width:"350px"}},z=n("h5",null,"Ajouter un candidat",-1),G=["initial-values"],H={class:"field"},J=n("label",{for:"title"},"Candidat",-1),K={key:0},O={key:1},Q={key:0},X={key:1},Z={class:"field"},P=n("label",{for:"title"},"Élection",-1),ce={__name:"ElectionCandidateAdditionForm",setup(ee){const b=F({electionId:g().required(),personId:g().required()}),{handleSubmit:S,errors:w,defineField:I,setFieldValue:y}=$({validationSchema:b}),[u,oe]=I("electionId"),[c,te]=I("personId");h(null);const i=T(),p=W(),C=h({}),r=N("dialogRef");j(()=>{r.value.data.electionId&&y("electionId",r.value.data.electionId),r.value.data.personId&&y("personId",r.value.data.personId),i.persons||i.refreshPersons(),p.elections||p.refreshElections()});const A=L(()=>{let m={};return i.persons.forEach(t=>m[t.id]=`${t.firstname} ${t.lastname}`),m}),_=h(!1),V=S(m=>{_.value=!0,R.elections.addElectionCandidate({electionId:u.value,personId:c.value}).then(t=>{r.value.close("success")}).finally(()=>_.value=!1)});return(m,t)=>(s(),l("div",Y,[z,n("form",{onSubmit:t[2]||(t[2]=(...e)=>o(V)&&o(V)(...e)),"initial-values":C.value.value},[n("div",H,[J,o(i).persons?(s(),d(o(f),{key:1,modelValue:o(c),"onUpdate:modelValue":t[0]||(t[0]=e=>k(c)?c.value=e:null),options:o(i).persons,optionLabel:"firstname",optionValue:"id",placeholder:"Choisir une personne",class:"w-full"},{value:v(e=>[e.value?(s(),l("span",K,a(A.value[e.value]),1)):(s(),l("span",O,a(e.placeholder),1))]),option:v(e=>[e.option?(s(),l("span",Q,a(e.option.firstname)+" "+a(e.option.lastname),1)):(s(),l("span",X,a(e.placeholder),1))]),_:1},8,["modelValue","options"])):(s(),d(o(f),{key:0,loading:"",placeholder:"Chargement en cours...",class:"w-full"}))]),n("div",Z,[P,o(p).elections?(s(),d(o(f),{key:1,modelValue:o(u),"onUpdate:modelValue":t[1]||(t[1]=e=>k(u)?u.value=e:null),options:o(p).elections,optionLabel:"title",optionValue:"id",placeholder:"Choisir une élection",class:"w-full"},null,8,["modelValue","options"])):(s(),d(o(f),{key:0,loading:"",placeholder:"Chargement en cours...",class:"w-full"}))]),q(o(B),{type:"submit",label:"Soumettre",class:"w-full",loading:_.value},null,8,["loading"])],40,G),(s(!0),l(U,null,D(o(w),(e,E)=>(s(),d(o(x),{severity:"error",key:E},{default:v(()=>[M(a(e),1)]),_:2},1024))),128))]))}};export{ce as default};
