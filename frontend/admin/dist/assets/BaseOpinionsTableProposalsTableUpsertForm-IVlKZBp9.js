import{c as T,d as U,a as j,u as q}from"./index.esm-v6cDy30M.js";import{s as C}from"./textarea.esm-36WrxFgm.js";import{b as M,s as z}from"./index.esm-BEizDpwn.js";import{s as D}from"./message.esm-43B1DmQ7.js";import{r as u,Y as E,o as L,A as k,a as p,c as x,b as t,k as A,g as m,f as o,W as B,F as O,p as W,e as Y,w as G,h as H}from"./index-om2yVH6z.js";const J={style:{width:"650px"}},K=["initial-values"],Q={class:"formgrid grid"},X={class:"field col-6"},Z=t("label",{for:"number"},"Number",-1),ee={class:"formgrid grid"},ae={class:"field col"},oe=t("label",{for:"content"},"Contenu",-1),ce={__name:"BaseOpinionsTableProposalsTableUpsertForm",setup(se){const N=T({number:U().required(),content:j().required()}),{handleSubmit:P,errors:R,defineField:f,setFieldValue:v}=q({validationSchema:N}),[d,te]=f("content"),[c,le]=f("number"),n=u(null),b=u(null),I=u({}),s=E("dialogRef");L(()=>{var l,e,a,r,g,h,V,y,w,F,S,$;(e=(l=s.value.data)==null?void 0:l.proposal)!=null&&e.content&&v("content",(r=(a=s.value.data)==null?void 0:a.proposal)==null?void 0:r.content),(h=(g=s.value.data)==null?void 0:g.proposal)!=null&&h.number&&v("number",(y=(V=s.value.data)==null?void 0:V.proposal)==null?void 0:y.number),n.value=(F=(w=s.value.data)==null?void 0:w.proposal)==null?void 0:F.id,b.value=($=(S=s.value.data)==null?void 0:S.opinion)==null?void 0:$.id});const i=u(!1),_=P(l=>{i.value=!0,n.value?k.opinions.updateProposal({...l,id:n.value}).then(e=>{s.value.close("success")}).finally(()=>i.value=!1):k.opinions.addProposal({opinionId:b.value,...l}).then(e=>{s.value.close("success")}).finally(()=>i.value=!1)});return(l,e)=>(p(),x("div",J,[t("h5",null,A(n.value?"Modifier":"Ajouter")+" une proposition",1),t("form",{onSubmit:e[2]||(e[2]=(...a)=>o(_)&&o(_)(...a)),"initial-values":I.value.value},[t("div",Q,[t("div",X,[Z,m(o(M),{id:"number",type:"number",modelValue:o(c),"onUpdate:modelValue":e[0]||(e[0]=a=>B(c)?c.value=a:null),class:"w-full"},null,8,["modelValue"])])]),t("div",ee,[t("div",ae,[oe,m(o(C),{id:"content",modelValue:o(d),"onUpdate:modelValue":e[1]||(e[1]=a=>B(d)?d.value=a:null),class:"w-full",autoResize:!0},null,8,["modelValue"])])]),m(o(z),{type:"submit",label:"Soumettre",class:"w-full",loading:i.value},null,8,["loading"])],40,K),(p(!0),x(O,null,W(o(R),(a,r)=>(p(),Y(o(D),{severity:"error",key:r},{default:G(()=>[H(A(a),1)]),_:2},1024))),128))]))}};export{ce as default};
