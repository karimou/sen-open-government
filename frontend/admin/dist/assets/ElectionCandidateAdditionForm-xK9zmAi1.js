import{r as g,Y as L,a as N,j as R,A as U,u as D,o as s,c as n,b as r,f as o,e as c,w as h,t as i,W as V,g as k,F as P,p as q,h as T,i as M,_ as O}from"./index-T5lfGDRy.js";import{c as W,d as b,u as Y,s as z}from"./message.esm-CLFrG8pF.js";import{s as C}from"./index.esm-vgHkgeCn.js";import{c as f}from"./AppTableSkeleton-tDWp2KOa.js";import{u as G}from"./persons-uZLKvvDa.js";import{u as H}from"./ElectionsView-pnqGbQA6.js";const J={style:{width:"350px"}},K=r("h5",null,"Ajouter un candidat",-1),Q=["initial-values"],X={class:"field"},Z=r("label",{for:"title"},"Candidat",-1),ee={key:0},oe={key:1},te={key:0},se={key:1},ae={class:"field"},le=r("label",{for:"title"},"Élection",-1),_e={__name:"ElectionCandidateAdditionForm",setup(ne){const S=W({electionId:b().required(),personId:b().required()}),{handleSubmit:A,errors:w,defineField:v,setFieldValue:I}=Y({validationSchema:S}),[u,ie]=v("electionId"),[p,re]=v("personId"),a=G(),m=H(),E=g({}),d=L("dialogRef");N(()=>{d.value.data.electionId&&I("electionId",d.value.data.electionId),d.value.data.personId&&I("personId",d.value.data.personId),a.persons||a.refreshPersons(),m.elections||m.refreshElections()});const F=R(()=>{let l={};return a.persons.forEach(t=>l[t.id]=`${t.firstname} ${t.lastname}`),l}),_=g(!1),y=A(l=>{_.value=!0,U.elections.addElectionCandidate({electionId:u.value,personId:p.value}).then(t=>{d.value.close("success")}).finally(()=>_.value=!1)}),x=D(),$=M(()=>O(()=>import("./PersonsUpsertForm-Hw4NXnGj.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),j=(l={})=>{x.open($,{data:l,onClose:t=>{(t==null?void 0:t.data)=="success"&&a.refreshPersons()},props:{modal:!0}})};return(l,t)=>(s(),n("div",J,[K,r("form",{onSubmit:t[2]||(t[2]=(...e)=>o(y)&&o(y)(...e)),"initial-values":E.value.value},[r("div",X,[Z,o(a).persons?(s(),c(o(f),{key:1,modelValue:o(p),"onUpdate:modelValue":t[0]||(t[0]=e=>V(p)?p.value=e:null),options:o(a).persons,optionLabel:"firstname",optionValue:"id",placeholder:"Choisir une personne",class:"w-full",filter:""},{value:h(e=>[e.value?(s(),n("span",ee,i(F.value[e.value]),1)):(s(),n("span",oe,i(e.placeholder),1))]),option:h(e=>[e.option?(s(),n("span",te,i(e.option.firstname)+" "+i(e.option.lastname),1)):(s(),n("span",se,i(e.placeholder),1))]),_:1},8,["modelValue","options"])):(s(),c(o(f),{key:0,loading:"",placeholder:"Chargement en cours...",class:"w-full"})),k(o(C),{label:"Ajouter une personne",icon:"pi pi-plus",text:"",onClick:j})]),r("div",ae,[le,o(m).elections?(s(),c(o(f),{key:1,modelValue:o(u),"onUpdate:modelValue":t[1]||(t[1]=e=>V(u)?u.value=e:null),options:o(m).elections,optionLabel:"title",optionValue:"id",placeholder:"Choisir une élection",class:"w-full",filter:""},null,8,["modelValue","options"])):(s(),c(o(f),{key:0,loading:"",placeholder:"Chargement en cours...",class:"w-full"}))]),k(o(C),{type:"submit",label:"Soumettre",class:"w-full",loading:_.value},null,8,["loading"])],40,Q),(s(!0),n(P,null,q(o(w),(e,B)=>(s(),c(o(z),{severity:"error",key:B},{default:h(()=>[T(i(e),1)]),_:2},1024))),128))]))}};export{_e as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/PersonsUpsertForm-Hw4NXnGj.js","assets/message.esm-CLFrG8pF.js","assets/index-T5lfGDRy.js","assets/index-tbN9M-MT.css","assets/index.esm-vgHkgeCn.js","assets/textarea.esm-h-8ZmNWD.js","assets/editor.esm-6r_DiYhw.js","assets/format-39s6QTMr.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
