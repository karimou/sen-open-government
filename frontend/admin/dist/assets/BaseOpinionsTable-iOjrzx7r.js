import{$ as L,r as _,u as q,Y,a as n,c as p,b as s,f as e,e as h,g as a,H as O,w as d,F as A,j as y,E as I,h as z,A as J,i as R,_ as S}from"./index-nfabErwM.js";import{c as K,s as Q,a as m,b as W,_ as X}from"./AppTableSkeleton-ccuFNckQ.js";import{s as c}from"./index.esm-GIVjqfaJ.js";import{s as G}from"./avatar.esm-gtHlE3uH.js";const Z={class:"grid"},P={class:"col-12"},ee={key:1,class:"card"},te={class:"my-2"},oe={class:"p-float-label"},ae=s("label",null,"Grouper par:",-1),se=s("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},[s("h5",{class:"m-0"},"Opinions")],-1),le={class:"vertical-align-middle ml-2 font-bold line-height-3"},ne={class:"vertical-align-middle ml-2 font-bold line-height-3"},ie={key:2,class:"px-4 py-5 shadow-1 flex flex-column md:flex-row md:align-items-center justify-content-between mb-3",style:{width:"600px","background-color":"white"}},de=s("div",null,[s("div",{class:"font-medium text-xl mt-2 mb-3"},"Aucune opinion"),s("div",{class:"font-medium"},"Cliquer sur le bouton suivant pour rajouter une première opinion à la base de données")],-1),re={class:"mt-4 mr-auto md:mt-0 md:mr-0"},ve={__name:"BaseOpinionsTable",props:{opinions:Array,personId:Number,issueId:Number,defaultGroupingHeader:{type:String,default:"author.name"},group:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["refresh"],setup(V,{emit:B}){const j=V,{opinions:w,group:u,personId:x,issueId:k,loading:f,defaultGroupingHeader:N}=L(j),b=B,r=_(null),E=()=>{var o;let l=(o=r.value)==null?void 0:o.map(v=>v.id);f.value=!0,J.opinions.deleteOpinions(l).then(()=>{b("refresh"),r.value=null}).finally(()=>f.value=!1)},C=q(),F=R(()=>S(()=>import("./OpinionsUpsertForm-iVTrloia.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),g=(l={author_id:x.value,issue_id:k.value})=>{C.open(F,{data:l,onClose:()=>b("refresh"),props:{modal:!0}})},D=R(()=>S(()=>import("./AppOpinionsCsvImport-U0YRBZbM.js"),__vite__mapDeps([11,1,2,8,5,12,4,10,9]))),H=()=>{C.open(D,{data:{personId:x.value,issueId:k.value},onClose:()=>b("refresh"),props:{modal:!0}})},T=l=>`${l.firstname} ${l.lastname}`,U=Y(()=>w.value.map(l=>({...l,author:{...l.author,name:T(l.author)}}))),$=_(),i=_(N.value),M=[{field:"author.name",label:"Auteur"},{field:"issue.title",label:"Thème"}];return(l,o)=>{var v;return n(),p("div",Z,[s("div",P,[e(f)?(n(),h(X,{key:0})):((v=e(w))==null?void 0:v.length)>0?(n(),p("div",ee,[a(e(Q),{class:"mb-4"},O({start:d(()=>[s("div",te,[a(e(c),{label:"Ajouter une opinion",icon:"pi pi-plus",class:"p-button-success mr-2",onClick:o[0]||(o[0]=t=>g())}),a(e(c),{label:"Import un CSV",icon:"pi pi-file-import",class:"p-button-primary mr-2",onClick:o[1]||(o[1]=t=>H())}),a(e(c),{label:"Supprimer la sélection",icon:"pi pi-trash",class:"p-button-danger",onClick:o[2]||(o[2]=t=>E()),disabled:!r.value||!r.value.length,loading:e(f)},null,8,["disabled","loading"])])]),_:2},[e(u)?{name:"end",fn:d(()=>[s("div",oe,[a(e(K),{options:M,modelValue:i.value,"onUpdate:modelValue":o[3]||(o[3]=t=>i.value=t),optionLabel:"label",optionValue:"field"},null,8,["modelValue"]),ae])]),key:"0"}:void 0]),1024),(n(),h(e(W),{key:i.value,value:U.value,tableStyle:"min-width: 50rem",selection:r.value,"onUpdate:selection":o[4]||(o[4]=t=>r.value=t),expandedRowGroups:$.value,"onUpdate:expandedRowGroups":o[5]||(o[5]=t=>$.value=t),expandableRowGroups:e(u),rowGroupMode:e(u)?"subheader":null,groupRowsBy:e(u)?i.value:null,sortMode:"single",sortField:i.value,sortOrder:1},O({header:d(()=>[se]),default:d(()=>[a(e(m),{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(e(m),{headerStyle:"width: 60px"},{body:d(({data:t})=>[a(e(c),{class:"p-button-text p-button-rounded",icon:"pi pi-pencil",onClick:ue=>g(t)},null,8,["onClick"])]),_:1}),a(e(m),{field:"author.name",header:"Auteur"}),a(e(m),{field:"issue.title",header:"Sujet"}),a(e(m),{field:"summary",header:"Résumé",headerStyle:"width: 500px",bodyStyle:"white-space: pre-wrap",bodyClass:"truncate l3"})]),_:2},[e(u)?{name:"groupheader",fn:d(t=>[i.value=="author.name"?(n(),p(A,{key:0},[t.data.author.photo?(n(),h(e(G),{key:0,class:"contained-image ml-2 vertical-align-middle",image:t.data.author.photo,width:"32",shape:"circle"},null,8,["image"])):y("",!0),s("span",le,I(t.data.author.name),1)],64)):i.value=="issue.title"?(n(),p(A,{key:1},[t.data.issue.photo?(n(),h(e(G),{key:0,class:"contained-image ml-2 vertical-align-middle",image:t.data.issue.photo,width:"32",shape:"circle"},null,8,["image"])):y("",!0),s("span",ne,I(t.data.issue.title),1)],64)):y("",!0)]),key:"0"}:void 0]),1032,["value","selection","expandedRowGroups","expandableRowGroups","rowGroupMode","groupRowsBy","sortField"]))])):(n(),p("div",ie,[de,s("div",re,[a(e(c),{class:"p-button font-bold px-5 py-3 p-button-success p-button-rounded p-button-raised",onClick:o[6]||(o[6]=t=>g())},{default:d(()=>[z("Ajouter")]),_:1})])]))])])}}};export{ve as _};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/OpinionsUpsertForm-iVTrloia.js","assets/index-nfabErwM.js","assets/index-ZWerLMmy.css","assets/index.esm-0v3skzw3.js","assets/message.esm-N4VlxvCC.js","assets/index.esm-GIVjqfaJ.js","assets/textarea.esm-CrUwpLue.js","assets/editor.esm-yhnS-dCw.js","assets/AppTableSkeleton-ccuFNckQ.js","assets/persons-OwiZqDYI.js","assets/issues-dvrVKkju.js","assets/AppOpinionsCsvImport-U0YRBZbM.js","assets/fileupload.esm-aJebuPhH.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
