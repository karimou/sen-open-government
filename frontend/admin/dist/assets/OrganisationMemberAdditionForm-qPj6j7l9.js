import{r as k,X as B,o as L,Y as M,A as N,u as j,a,c as r,b as t,f as o,e as u,w as I,E as d,V,g as b,F as D,n as P,h as q,i as T,_ as X}from"./index-LTkJtgF3.js";import{c as Y,d as A,a as z,u as G,s as H}from"./message.esm-UA5ETg2a.js";import{s as S,b as J}from"./index.esm-AA2EX6A9.js";import{c as _}from"./AppTableSkeleton-kSd5XViM.js";import{u as K}from"./persons-20QzxUx3.js";import{u as Q}from"./OrganisationsView-XCxTIIJ3.js";const W={style:{width:"350px"}},Z=t("h5",null,"Ajouter un membre",-1),ee=["initial-values"],oe={class:"field"},se=t("label",{for:"title"},"Membre",-1),ae={key:0},te={key:1},ne={key:0},le={key:1},ie={class:"field"},re=t("label",{for:"title"},"Organisation",-1),de={class:"field"},ue=t("label",{for:"role"},"Role",-1),be={__name:"OrganisationMemberAdditionForm",setup(ce){const w=Y({organisationId:A().required(),personId:A().required(),role:z()}),{handleSubmit:C,errors:F,defineField:g,setFieldValue:v}=G({validationSchema:w}),[c,pe]=g("organisationId"),[p,me]=g("personId"),[m,fe]=g("role"),l=K(),f=Q(),$=k({}),n=B("dialogRef");L(()=>{n.value.data.organisationId&&v("organisationId",n.value.data.organisationId),n.value.data.personId&&v("personId",n.value.data.personId),n.value.data.role&&v("personId",n.value.data.role),l.persons||l.refreshPersons(),f.organisations||f.refreshOrganisations()});const x=M(()=>{let i={};return l.persons.forEach(s=>i[s.id]=`${s.firstname} ${s.lastname}`),i}),h=k(!1),y=C(i=>{h.value=!0,N.organisations.addOrganisationMember({organisationId:c.value,personId:p.value,role:m.value}).then(s=>{n.value.close("success")}).finally(()=>h.value=!1)}),O=j(),E=T(()=>X(()=>import("./PersonsUpsertForm-S9iaLVJv.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),R=(i={})=>{O.open(E,{data:i,onClose:s=>{(s==null?void 0:s.data)=="success"&&l.refreshPersons()},props:{modal:!0}})};return(i,s)=>(a(),r("div",W,[Z,t("form",{onSubmit:s[3]||(s[3]=(...e)=>o(y)&&o(y)(...e)),"initial-values":$.value.value},[t("div",oe,[se,o(l).persons?(a(),u(o(_),{key:1,modelValue:o(p),"onUpdate:modelValue":s[0]||(s[0]=e=>V(p)?p.value=e:null),options:o(l).persons,optionLabel:"firstname",optionValue:"id",placeholder:"Choisir une personne",class:"w-full",filter:""},{value:I(e=>[e.value?(a(),r("span",ae,d(x.value[e.value]),1)):(a(),r("span",te,d(e.placeholder),1))]),option:I(e=>[e.option?(a(),r("span",ne,d(e.option.firstname)+" "+d(e.option.lastname),1)):(a(),r("span",le,d(e.placeholder),1))]),_:1},8,["modelValue","options"])):(a(),u(o(_),{key:0,loading:"",placeholder:"Chargement en cours...",class:"w-full"})),b(o(S),{label:"Ajouter une personne",icon:"pi pi-plus",text:"",onClick:R})]),t("div",ie,[re,o(f).organisations?(a(),u(o(_),{key:1,modelValue:o(c),"onUpdate:modelValue":s[1]||(s[1]=e=>V(c)?c.value=e:null),options:o(f).organisations,optionLabel:"name",optionValue:"id",placeholder:"Choisir une organisation",class:"w-full",filter:""},null,8,["modelValue","options"])):(a(),u(o(_),{key:0,loading:"",placeholder:"Chargement en cours...",class:"w-full"}))]),t("div",de,[ue,b(o(J),{id:"role",type:"text",modelValue:o(m),"onUpdate:modelValue":s[2]||(s[2]=e=>V(m)?m.value=e:null),class:"w-full"},null,8,["modelValue"])]),b(o(S),{type:"submit",label:"Soumettre",class:"w-full",loading:h.value},null,8,["loading"])],40,ee),(a(!0),r(D,null,P(o(F),(e,U)=>(a(),u(o(H),{severity:"error",key:U},{default:I(()=>[q(d(e),1)]),_:2},1024))),128))]))}};export{be as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/PersonsUpsertForm-S9iaLVJv.js","assets/message.esm-UA5ETg2a.js","assets/index-LTkJtgF3.js","assets/index-D9x--RlZ.css","assets/index.esm-AA2EX6A9.js","assets/textarea.esm-Hm93eXmG.js","assets/editor.esm-p-MO2Hmf.js","assets/AppPicturesSelector-rCdsnUdI.js","assets/AppTableSkeleton-kSd5XViM.js","assets/index.esm-9D7YHrr2.js","assets/format-39s6QTMr.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
