import{Y as H,r as b,u as U,$ as E,o as n,c as u,b as l,f as e,e as w,g as a,H as x,w as d,F as M,l as k,E as $,h as T,A as D,i as L,_ as q}from"./index-HWtTsvFM.js";import{c as Y,s as z,a as m,b as J,_ as K}from"./AppTableSkeleton-3-U8kaGt.js";import{s as h}from"./index.esm-FaUUA4nG.js";const Q={class:"grid"},W={class:"col-12"},X={key:1,class:"card"},Z={class:"my-2"},P={class:"p-float-label"},ee=l("label",null,"Grouper par:",-1),te=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},[l("h5",{class:"m-0"},"Opinions")],-1),oe=["alt","src"],se={class:"vertical-align-middle ml-2 font-bold line-height-3"},ae={key:1,class:"vertical-align-middle ml-2 font-bold line-height-3"},le={key:2,class:"px-4 py-5 shadow-1 flex flex-column md:flex-row md:align-items-center justify-content-between mb-3",style:{width:"600px","background-color":"white"}},ne=l("div",null,[l("div",{class:"font-medium text-xl mt-2 mb-3"},"Aucune opinion"),l("div",{class:"font-medium"},"Cliquer sur le bouton suivant pour rajouter une première opinion à la base de données")],-1),ie={class:"mt-4 mr-auto md:mt-0 md:mr-0"},me={__name:"BaseOpinionsTable",props:{opinions:Array,personId:Number,issueId:Number,defaultGroupingHeader:{type:String,default:"author.name"},group:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["refresh"],setup(G,{emit:R}){const A=G,{opinions:_,group:p,personId:C,issueId:O,loading:c,defaultGroupingHeader:B}=H(A),g=R,r=b(null),S=()=>{var o;let s=(o=r.value)==null?void 0:o.map(f=>f.id);c.value=!0,D.opinions.deleteOpinions(s).then(()=>{g("refresh"),r.value=null}).finally(()=>c.value=!1)},V=U(),N=L(()=>q(()=>import("./OpinionsUpsertForm-pntpDPY2.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),v=(s={author_id:C.value,issue_id:O.value})=>{V.open(N,{data:s,onClose:()=>g("refresh"),props:{modal:!0}})},j=s=>`${s.firstname} ${s.lastname}`,F=E(()=>_.value.map(s=>({...s,author:{...s.author,name:j(s.author)}}))),y=b(),i=b(B.value),I=[{field:"author.name",label:"Auteur"},{field:"issue.title",label:"Thème"}];return(s,o)=>{var f;return n(),u("div",Q,[l("div",W,[e(c)?(n(),w(K,{key:0})):((f=e(_))==null?void 0:f.length)>0?(n(),u("div",X,[a(e(z),{class:"mb-4"},x({start:d(()=>[l("div",Z,[a(e(h),{label:"Ajouter une opinion",icon:"pi pi-plus",class:"p-button-success mr-2",onClick:o[0]||(o[0]=t=>v())}),a(e(h),{label:"Supprimer la sélection",icon:"pi pi-trash",class:"p-button-danger",onClick:o[1]||(o[1]=t=>S()),disabled:!r.value||!r.value.length,loading:e(c)},null,8,["disabled","loading"])])]),_:2},[e(p)?{name:"end",fn:d(()=>[l("div",P,[a(e(Y),{options:I,modelValue:i.value,"onUpdate:modelValue":o[2]||(o[2]=t=>i.value=t),optionLabel:"label",optionValue:"field"},null,8,["modelValue"]),ee])]),key:"0"}:void 0]),1024),(n(),w(e(J),{key:i.value,value:F.value,tableStyle:"min-width: 50rem",selection:r.value,"onUpdate:selection":o[3]||(o[3]=t=>r.value=t),expandedRowGroups:y.value,"onUpdate:expandedRowGroups":o[4]||(o[4]=t=>y.value=t),expandableRowGroups:e(p),rowGroupMode:e(p)?"subheader":null,groupRowsBy:e(p)?i.value:null,sortMode:"single",sortField:i.value,sortOrder:1},x({header:d(()=>[te]),default:d(()=>[a(e(m),{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(e(m),{headerStyle:"min-width: 20px"},{body:d(({data:t})=>[a(e(h),{class:"p-button-text p-button-rounded",icon:"pi pi-pencil",onClick:de=>v(t)},null,8,["onClick"])]),_:1}),a(e(m),{field:"author.name",header:"Auteur"}),a(e(m),{field:"issue.title",header:"Sujet"}),a(e(m),{field:"summary",header:"Résumé"})]),_:2},[e(p)?{name:"groupheader",fn:d(t=>[i.value=="author.name"?(n(),u(M,{key:0},[t.data.author.photo?(n(),u("img",{key:0,alt:t.data.author.name,src:t.data.author.photo,width:"32",style:{"vertical-align":"middle"},class:"ml-2"},null,8,oe)):k("",!0),l("span",se,$(t.data.author.name),1)],64)):i.value=="issue.title"?(n(),u("span",ae,$(t.data.issue.title),1)):k("",!0)]),key:"0"}:void 0]),1032,["value","selection","expandedRowGroups","expandableRowGroups","rowGroupMode","groupRowsBy","sortField"]))])):(n(),u("div",le,[ne,l("div",ie,[a(e(h),{class:"p-button font-bold px-5 py-3 p-button-success p-button-rounded p-button-raised",onClick:o[5]||(o[5]=t=>v())},{default:d(()=>[T("Ajouter")]),_:1})])]))])])}}};export{me as _};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/OpinionsUpsertForm-pntpDPY2.js","assets/index-HWtTsvFM.js","assets/index-tbN9M-MT.css","assets/message.esm-OieoKZiQ.js","assets/index.esm-FaUUA4nG.js","assets/textarea.esm-WoudxIoE.js","assets/editor.esm-kVSwRZPD.js","assets/AppTableSkeleton-3-U8kaGt.js","assets/persons-MqOyPKi7.js","assets/issues-1SwNP8eB.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
