import{r as k,Y as M,a as z,j as W,A as w,u as Y,o as a,c as r,b as l,t as i,f as s,e as c,w as A,W as h,g as m,F as G,p as H,h as J,i as U,_ as $}from"./index-T5lfGDRy.js";import{c as K,d as x,a as I,u as Q,s as X}from"./message.esm-CLFrG8pF.js";import{s as Z}from"./textarea.esm-h-8ZmNWD.js";import{s as C}from"./index.esm-vgHkgeCn.js";import{s as ee}from"./editor.esm-6r_DiYhw.js";import{c as v}from"./AppTableSkeleton-tDWp2KOa.js";import{u as se}from"./persons-uZLKvvDa.js";import{u as oe}from"./issues-o02nH_GU.js";const te={style:{width:"650px"}},ae=["initial-values"],le={class:"formgrid grid"},ie={class:"field col-6"},ne=l("label",{for:"title"},"Auteur",-1),re={key:0},ue={key:1},de={key:0},ce={key:1},me={class:"field col-6"},pe=l("label",{for:"title"},"Thème",-1),_e={class:"field"},fe=l("label",{for:"summary"},"Résumé",-1),he={class:"field"},ve=l("label",{for:"content"},"Contenu détaillé",-1),Ie={__name:"OpinionsUpsertForm",setup(ye){const E=K({author_id:x().required(),issue_id:x().required(),summary:I().required(),content:I()}),{handleSubmit:R,errors:j,defineField:p,setFieldValue:L}=Q({validationSchema:E}),[y,Ve]=p("author_id"),[V,ge]=p("issue_id"),[g,be]=p("summary"),[b,ke]=p("content"),_=k(null),n=se(),u=oe(),O=k({}),d=M("dialogRef");z(()=>{var t;["author_id","issue_id","summary","content"].forEach(e=>{d.value.data[e]&&L(e,d.value.data[e])}),_.value=(t=d.value.data)==null?void 0:t.id,n.persons||n.refreshPersons(),u.issues||u.refreshIssues()});const B=W(()=>{let t={};return n.persons.forEach(e=>t[e.id]=`${e.firstname} ${e.lastname}`),t}),f=k(!1),S=R(t=>{f.value=!0,_.value?w.opinions.updateOpinion({...t,id:_.value}).then(e=>{d.value.close("success")}).finally(()=>f.value=!1):w.opinions.addOpinion(t).then(e=>{d.value.close("success")}).finally(()=>f.value=!1)}),F=Y(),D=U(()=>$(()=>import("./PersonsUpsertForm-Hw4NXnGj.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),N=(t={})=>{F.open(D,{data:t,onClose:e=>{(e==null?void 0:e.data)=="success"&&n.refreshPersons()},props:{modal:!0}})},P=U(()=>$(()=>import("./IssuesUpsertForm-cOHiKp2W.js"),__vite__mapDeps([8,1,2,3,4,5,6]))),T=(t={})=>{F.open(P,{data:t,onClose:e=>{(e==null?void 0:e.data)=="success"&&u.refreshIssues()},props:{modal:!0}})};return(t,e)=>(a(),r("div",te,[l("h5",null,i(_.value?"Modifier":"Ajouter")+" une opinion",1),l("form",{onSubmit:e[4]||(e[4]=(...o)=>s(S)&&s(S)(...o)),"initial-values":O.value.value},[l("div",le,[l("div",ie,[ne,s(n).persons?(a(),c(s(v),{key:1,modelValue:s(y),"onUpdate:modelValue":e[0]||(e[0]=o=>h(y)?y.value=o:null),options:s(n).persons,optionLabel:"firstname",optionValue:"id",placeholder:"Choisir une personne",class:"w-full",filter:""},{value:A(o=>[o.value?(a(),r("span",re,i(B.value[o.value]),1)):(a(),r("span",ue,i(o.placeholder),1))]),option:A(o=>[o.option?(a(),r("span",de,i(o.option.firstname)+" "+i(o.option.lastname),1)):(a(),r("span",ce,i(o.placeholder),1))]),_:1},8,["modelValue","options"])):(a(),c(s(v),{key:0,loading:"",placeholder:"Chargement en cours...",class:"w-full"})),m(s(C),{label:"Ajouter une personne",icon:"pi pi-plus",text:"",onClick:N})]),l("div",me,[pe,s(u).issues?(a(),c(s(v),{key:1,modelValue:s(V),"onUpdate:modelValue":e[1]||(e[1]=o=>h(V)?V.value=o:null),options:s(u).issues,optionLabel:"title",optionValue:"id",placeholder:"Choisir un thème",class:"w-full",filter:""},null,8,["modelValue","options"])):(a(),c(s(v),{key:0,loading:"",placeholder:"Chargement en cours...",class:"w-full"})),m(s(C),{label:"Ajouter un thème",icon:"pi pi-plus",text:"",onClick:T})])]),l("div",_e,[fe,m(s(Z),{id:"summary",modelValue:s(g),"onUpdate:modelValue":e[2]||(e[2]=o=>h(g)?g.value=o:null),class:"w-full",autoResize:!0},null,8,["modelValue"])]),l("div",he,[ve,m(s(ee),{modelValue:s(b),"onUpdate:modelValue":e[3]||(e[3]=o=>h(b)?b.value=o:null),id:"content",editorStyle:"height: 320px"},null,8,["modelValue"])]),m(s(C),{type:"submit",label:"Soumettre",class:"w-full",loading:f.value},null,8,["loading"])],40,ae),(a(!0),r(G,null,H(s(j),(o,q)=>(a(),c(s(X),{severity:"error",key:q},{default:A(()=>[J(i(o),1)]),_:2},1024))),128))]))}};export{Ie as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/PersonsUpsertForm-Hw4NXnGj.js","assets/message.esm-CLFrG8pF.js","assets/index-T5lfGDRy.js","assets/index-tbN9M-MT.css","assets/index.esm-vgHkgeCn.js","assets/textarea.esm-h-8ZmNWD.js","assets/editor.esm-6r_DiYhw.js","assets/format-39s6QTMr.js","assets/IssuesUpsertForm-cOHiKp2W.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
